<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - JoTouch by Lara</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>ðŸ‡¯ðŸ‡´ JoTouch by Lara</h1>
            </div>
            <div class="nav-search">
                <input type="text" placeholder="Search for products..." id="searchInput" data-key="searchPlaceholder">
                <button><i class="fas fa-search"></i></button>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link" data-key="home">Home</a>
                <a href="about.html" class="nav-link" data-key="about">About Us</a>
                <a href="contact.html" class="nav-link" data-key="contact">Contact Us</a>
                <a href="comments.html" class="nav-link">Comments</a>
                <a href="favorites.html" class="nav-link">
                    <i class="fas fa-heart"></i>
                    <span class="cart-count" id="favoritesCount">0</span>
                </a>
                <a href="cart.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <button class="language-switcher" onclick="switchLanguage(currentLanguage === 'en' ? 'ar' : 'en')" id="langBtn">
                    <i class="fas fa-language"></i> <span id="langText">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <section class="login-section">
        <div class="container">
            <div class="login-container">
                <h2 data-key="login">Login</h2>
                <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="username" data-key="username">Username</label>
                        <input type="text" id="username" name="username" required placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="email" data-key="email">Email</label>
                        <input type="email" id="email" name="email" required placeholder="Enter your email">
                    </div>
                    <button type="submit" class="login-btn" data-key="login">Login</button>
                </form>
                <div class="login-footer">
                    <p data-key="noAccount">Don't have an account? <a href="index.html" data-key="continueShopping">Continue Shopping</a></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>Your trusted marketplace for authentic Jordanian products. Supporting local businesses and artisans.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="#productsSection">Products</a></li>
                        <li><a href="cart.html">Cart</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p>Email: info@jordanianmarketplace.com</p>
                    <p>Phone: +962 6 123 4567</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Jordanian Marketplace. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="language.js"></script>
    <script src="currency.js"></script>
    <script src="script.js"></script>
    <script src="navigation.js"></script>
    <script>
        // Login functionality
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            
            if (!username || !email) {
                const currentLang = localStorage.getItem('language') || 'en';
                const message = currentLang === 'ar' 
                    ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'
                    : 'Please enter both username and email';
                alert(message);
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                const currentLang = localStorage.getItem('language') || 'en';
                const message = currentLang === 'ar' 
                    ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­'
                    : 'Please enter a valid email address';
                alert(message);
                return;
            }
            
            // Store user data in localStorage
            const userData = {
                username: username,
                email: email,
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('currentUser', JSON.stringify(userData));
            
            // Get guest session cart (if any)
            const guestCart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Load user's saved cart
            const userCartKey = `cart_${email}`;
            let savedCart = JSON.parse(localStorage.getItem(userCartKey)) || [];
            
            // Merge guest session items with saved user items (avoid duplicates)
            if (guestCart.length > 0) {
                guestCart.forEach(guestItem => {
                    const existingItem = savedCart.find(item => item.id === guestItem.id && 
                        (!guestItem.selectedSize || item.selectedSize === guestItem.selectedSize));
                    if (existingItem) {
                        // Merge quantities
                        existingItem.quantity = Math.max(existingItem.quantity, guestItem.quantity);
                    } else {
                        savedCart.push(guestItem);
                    }
                });
            }
            
            // Save merged cart to user account
            localStorage.setItem(userCartKey, JSON.stringify(savedCart));
            
            // Favorites are session-only and start fresh on login (not persisted)
            // Keep any current session favorites temporarily, but they won't be saved to account
            const sessionFavorites = JSON.parse(localStorage.getItem('favorites')) || [];
            
            // Update global cart and favorites if script.js is loaded
            if (typeof window.cart !== 'undefined') {
                window.cart = savedCart;
                if (typeof saveUserCart === 'function') {
                    saveUserCart(savedCart);
                } else {
                    localStorage.setItem('cart', JSON.stringify(savedCart));
                }
            } else {
                localStorage.setItem('cart', JSON.stringify(savedCart));
            }
            
            // Favorites remain session-only (temporary)
            if (typeof window.favorites !== 'undefined') {
                window.favorites = sessionFavorites;
                if (typeof saveUserFavorites === 'function') {
                    saveUserFavorites(sessionFavorites);
                } else {
                    localStorage.setItem('favorites', JSON.stringify(sessionFavorites));
                }
            } else {
                localStorage.setItem('favorites', JSON.stringify(sessionFavorites));
            }
            
            // Show success message
            const currentLang = localStorage.getItem('language') || 'en';
            const message = currentLang === 'ar' 
                ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${username}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­`
                : `Welcome ${username}! Login successful`;
            
            showNotification(message);
            
            // Redirect to home page after a short delay
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }
        
        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const userData = JSON.parse(currentUser);
                const currentLang = localStorage.getItem('language') || 'en';
                const message = currentLang === 'ar' 
                    ? `Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ ÙƒÙ€ ${userData.username}`
                    : `You are already logged in as ${userData.username}`;
                
                // Redirect to home if already logged in
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
            
            updateCartCount();
            updateFavoritesCount();
        });
    </script>
</body>
</html>

